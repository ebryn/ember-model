// ==========================================================================
// Project:   Ember Model
// Copyright: Â©2013 Erik Bryn and contributors.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================

// 0.0.3-43-gc2da6bf
// c2da6bf (2013-07-17 08:33:34 -0500)

!function(){function a(a){var b=function(){throw new Error(a)};return b.isUnimplemented=!0,b}Ember.Adapter=Ember.Object.extend({find:a("Ember.Adapter subclasses must implement find"),findQuery:a("Ember.Adapter subclasses must implement findQuery"),findMany:a("Ember.Adapter subclasses must implement findMany"),findAll:a("Ember.Adapter subclasses must implement findAll"),createRecord:a("Ember.Adapter subclasses must implement createRecord"),saveRecord:a("Ember.Adapter subclasses must implement saveRecord"),deleteRecord:a("Ember.Adapter subclasses must implement deleteRecord"),load:function(a,b,c){a.load(b,c)}})}(),function(){var a=Ember.get;Ember.FixtureAdapter=Ember.Adapter.extend({_findData:function(b,c){var d=b.FIXTURES,e=c.toString(),f=a(b,"primaryKey"),g=Ember.A(d).find(function(a){return a[f].toString()===e});return g},find:function(a,b){var c=this._findData(a.constructor,b);return new Ember.RSVP.Promise(function(d){setTimeout(function(){Ember.run(a,a.load,b,c),d(a)})})},findMany:function(a,b,c){for(var d=(a.FIXTURES,[]),e=0,f=c.length;f>e;e++)d.push(this._findData(a,c[e]));return new Ember.RSVP.Promise(function(c){setTimeout(function(){Ember.run(b,b.load,a,d),c(b)})})},findAll:function(a,b){var c=a.FIXTURES;return new Ember.RSVP.Promise(function(d){setTimeout(function(){Ember.run(b,b.load,a,c),d(b)})})},createRecord:function(a){var b=a.constructor,c=b.FIXTURES;return new Ember.RSVP.Promise(function(d){setTimeout(function(){c.push(b.findFromCacheOrLoad(a.toJSON())),a.didCreateRecord(),d(a)})})},saveRecord:function(a){return new Ember.RSVP.Promise(function(b){setTimeout(function(){a.didSaveRecord(),b(a)})})},deleteRecord:function(a){return new Ember.RSVP.Promise(function(b){setTimeout(function(){a.didDeleteRecord(),b(a)})})}})}(),function(){var a=Ember.get,b=Ember.set;Ember.RecordArray=Ember.ArrayProxy.extend(Ember.Evented,{isLoaded:!1,isLoading:Ember.computed.not("isLoaded"),load:function(a,c){b(this,"content",this.materializeData(a,c)),this.notifyLoaded()},loadForFindMany:function(c){var d=a(this,"_ids").map(function(a){return c.cachedRecordForId(a)});b(this,"content",Ember.A(d)),this.notifyLoaded()},notifyLoaded:function(){b(this,"isLoaded",!0),this.trigger("didLoad")},materializeData:function(a,b){return Ember.A(b.map(function(b){return a.findFromCacheOrLoad(b)}))},reload:function(){var a=this.get("modelClass");b(this,"isLoading",!0),a.adapter.findAll(a,this)}})}(),function(){var a=Ember.get;Ember.FilteredRecordArray=Ember.RecordArray.extend({init:function(){if(!a(this,"modelClass"))throw new Error("FilteredRecordArrays must be created with a modelClass");if(!a(this,"filterFunction"))throw new Error("FilteredRecordArrays must be created with a filterFunction");if(!a(this,"filterProperties"))throw new Error("FilteredRecordArrays must be created with filterProperties");var b=a(this,"modelClass");b.registerRecordArray(this),this.registerObservers(),this.updateFilter()},updateFilter:function(){var b=this,c=[];a(this,"modelClass").forEachCachedRecord(function(a){b.filterFunction(a)&&c.push(a)}),this.set("content",Ember.A(c))},updateFilterForRecord:function(b){var c=a(this,"content");this.filterFunction(b)&&c.pushObject(b)},registerObservers:function(){var b=this;a(this,"modelClass").forEachCachedRecord(function(a){b.registerObserversOnRecord(a)})},registerObserversOnRecord:function(b){for(var c=this,d=a(this,"filterProperties"),e=0,f=a(d,"length");f>e;e++)b.addObserver(d[e],c,"updateFilterForRecord")}})}(),function(){var a=Ember.get;Ember.ManyArray=Ember.RecordArray.extend({_records:null,objectAtContent:function(b){var c=a(this,"content");if(c.length)return this.materializeRecord(b)},save:function(){return Ember.RSVP.all(this.map(function(a){return a.save()}))},replaceContent:function(a,b,c){c=Ember.EnumerableUtils.map(c,function(a){return a._reference},this),this._super(a,b,c)}}),Ember.HasManyArray=Ember.ManyArray.extend({materializeRecord:function(b){var c,d=a(this,"modelClass"),e=a(this,"content"),f=e.objectAt(b);return c=f.record?f.record:d.findById(f.id)},toJSON:function(){var a=[],b=this.get("content");return b.forEach(function(b){b.id&&a.push(b.id)}),a}}),Ember.EmbeddedHasManyArray=Ember.ManyArray.extend({create:function(b){var c=a(this,"modelClass"),d=c.create(b);return this.pushObject(d),d},materializeRecord:function(b){var c=a(this,"modelClass"),d=a(c,"primaryKey"),e=a(this,"content"),f=e.objectAt(b),g=f.data;if(f.record)return f.record;var h=c.create({_reference:f});return f.record=h,g&&h.load(g[d],g),h},toJSON:function(){return this.map(function(a){return a.toJSON()})}})}(),function(){function a(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return!0;return!1}function b(b,c){for(var d,e=0,f=c.length;f>e;e++)d=c[e],a(b,d)||b.push(d);return b}function c(a,b){var c=h(a,!1);return c?b in c.cache:void 0}function d(a,b,d){for(var f,g,i,j,k,l,m,n,o=0,p=b.length;p>o;o++)f=b[o],c(a,f)&&(l=a.cacheFor(f),k=e(a,"_data."+a.dataKey(f)),g=h(a).descs[f],i=g&&g.meta(),j=i.type,n=Ember.Model.dataTypes[j],m=j&&j.isEqual?!j.isEqual(k,l):n&&n.isEqual?!n.isEqual(k,l):k!==l?!0:!1,m&&d.push(f))}var e=Ember.get,f=Ember.set,g=Ember.setProperties,h=Ember.meta,i=Ember.String.underscore;Ember.run.queues.push("data"),Ember.Model=Ember.Object.extend(Ember.Evented,{isLoaded:!0,isLoading:Ember.computed.not("isLoaded"),isNew:!0,isDeleted:!1,_dirtyAttributes:null,getAttr:function(a,b){return b},isDirty:Ember.computed(function(){var a=this.attributes,b=this.relationships,c=Ember.A();return d(this,a,c),b&&d(this,b,c),c.length?(this._dirtyAttributes=c,!0):(this._dirtyAttributes=[],!1)}).property().volatile(),dataKey:function(a){var b=e(this.constructor,"camelizeKeys"),c=this.constructor.metaForProperty(a);return c.options&&c.options.key?b?i(c.options.key):c.options.key:b?i(a):a},init:function(){this._createReference(),this._super()},_createReference:function(){var a=this._reference,b=this.getPrimaryKey();return a||(a=this.constructor._referenceForId(b),a.record=this,this._reference=a),a.id||(a.id=b),a},getPrimaryKey:function(){return e(this,e(this.constructor,"primaryKey"))},load:function(a,b){var c={};c[e(this.constructor,"primaryKey")]=a,f(this,"_data",Ember.merge(c,b)),f(this,"isLoaded",!0),f(this,"isNew",!1),this._createReference(),this.trigger("didLoad")},didDefineProperty:function(a,b,c){if(c instanceof Ember.Descriptor){var d=c.meta();d.isAttribute?(a.attributes||(a.attributes=[]),a.attributes.push(b)):d.isRelationship&&(a.relationships||(a.relationships=[]),a.relationships.push(b))}},serializeHasMany:function(a){return this.get(a).toJSON()},serializeBelongsTo:function(a,b){if(b.options.embedded){var c=this.get(a);return c?c.toJSON():null}var d=e(b.getType(),"primaryKey");return this.get(a+"."+d)},toJSON:function(){var a,b,c={},d=this.attributes?this.getProperties(this.attributes):{},f=e(this.constructor,"rootKey");for(a in d)b=this.constructor.metaForProperty(a),c[this.dataKey(a)]=b.type&&b.type.serialize?b.type.serialize(d[a]):b.type&&Ember.Model.dataTypes[b.type]?Ember.Model.dataTypes[b.type].serialize(d[a]):d[a];if(this.relationships)for(var g,h,i=0;i<this.relationships.length;i++)a=this.relationships[i],b=this.constructor.metaForProperty(a),h=b.options.key||a,g="belongsTo"===b.kind?this.serializeBelongsTo(a,b):this.serializeHasMany(a,b),c[h]=g;if(f){var j={};return j[f]=c,j}return c},save:function(){var a=this.constructor.adapter;if(f(this,"isSaving",!0),e(this,"isNew"))return a.createRecord(this);if(e(this,"isDirty"))return a.saveRecord(this);var b=this,c=new Ember.RSVP.Promise(function(a){a(b)});return f(this,"isSaving",!1),c},reload:function(){return this.constructor.reload(this.get(e(this.constructor,"primaryKey")))},revert:function(){if(this.get("isDirty")){for(var a=e(this,"_data")||{},b={},c=0;c<this._dirtyAttributes.length;c++){var d=this._dirtyAttributes[c];b[d]=a[d]}g(this,b)}},didCreateRecord:function(){var a=e(this.constructor,"primaryKey"),b=e(this,a);f(this,"isNew",!1),this.constructor.recordCache||(this.constructor.recordCache={}),this.constructor.recordCache[b]=this,this._copyDirtyAttributesToData(),this.constructor.addToRecordArrays(this),this.trigger("didCreateRecord"),this.didSaveRecord()},didSaveRecord:function(){f(this,"isSaving",!1),this.trigger("didSaveRecord"),this.get("isDirty")&&this._copyDirtyAttributesToData()},deleteRecord:function(){return this.constructor.adapter.deleteRecord(this)},didDeleteRecord:function(){this.constructor.removeFromRecordArrays(this),f(this,"isDeleted",!0),this.trigger("didDeleteRecord")},_copyDirtyAttributesToData:function(){if(this._dirtyAttributes){var a,b=this._dirtyAttributes,c=e(this,"_data");c||(c={},f(this,"_data",c));for(var d=0,g=b.length;g>d;d++)a=b[d],c[this.dataKey(a)]=this.cacheFor(a);this._dirtyAttributes=[]}},dataDidChange:Ember.observer(function(){this._reloadHasManys()},"_data"),_registerHasManyArray:function(a){this._hasManyArrays||(this._hasManyArrays=Ember.A([])),this._hasManyArrays.pushObject(a)},_reloadHasManys:function(){if(this._hasManyArrays){var a;for(a=0;a<this._hasManyArrays.length;a++){var b=this._hasManyArrays[a];f(b,"content",this._getHasManyContent(e(b,"key"),e(b,"modelClass"),e(b,"embedded")))}}},_getHasManyContent:function(a,b,c){var d=e(this,"_data."+a);if(d){var f,g,h;c?(g=e(b,"primaryKey"),f=function(a){return h=b._referenceForId(a[g]),h.data=a,h}):f=function(a){return b._referenceForId(a)},d=Ember.EnumerableUtils.map(d,f)}return Ember.A(d||[])}}),Ember.Model.reopenClass({primaryKey:"id",adapter:Ember.Adapter.create(),_clientIdCounter:1,fetch:function(){return Ember.loadPromise(this.find.apply(this,arguments))},find:function(a){return arguments.length?Ember.isArray(a)?this.findMany(a):"object"==typeof a?this.findQuery(a):this.findById(a):this.findAll()},findMany:function(a){var c=Ember.RecordArray.create({_ids:a});return this.recordArrays||(this.recordArrays=[]),this.recordArrays.push(c),this._currentBatchIds?(b(this._currentBatchIds,a),this._currentBatchRecordArrays.push(c)):(this._currentBatchIds=b([],a),this._currentBatchRecordArrays=[c]),Ember.run.scheduleOnce("data",this,this._executeBatch),c},findAll:function(){if(this._findAllRecordArray)return this._findAllRecordArray;var a=this._findAllRecordArray=Ember.RecordArray.create({modelClass:this});return this.adapter.findAll(this,a),a},_currentBatchIds:null,_currentBatchRecordArrays:null,findById:function(a){var b=this.cachedRecordForId(a);return e(b,"isLoaded")||this._fetchById(b,a),b},reload:function(a){var b=this.cachedRecordForId(a);return this._fetchById(b,a),b},_fetchById:function(b,c){var d=e(this,"adapter");return!d.findMany||d.findMany.isUnimplemented?d.find(b,c):(this._currentBatchIds?a(this._currentBatchIds,c)||this._currentBatchIds.push(c):(this._currentBatchIds=[c],this._currentBatchRecordArrays=[]),Ember.run.scheduleOnce("data",this,this._executeBatch),void 0)},_executeBatch:function(){var a,b,c=this._currentBatchIds,d=this._currentBatchRecordArrays,f=this,g=[];for(this._currentBatchIds=null,this._currentBatchRecordArrays=null,b=0;b<c.length;b++)this.cachedRecordForId(c[b]).get("isLoaded")||g.push(c[b]);if(1===c.length)a=e(this,"adapter").find(this.cachedRecordForId(c[0]),c[0]);else{var h=Ember.RecordArray.create({_ids:c});0===g.length?(a=new Ember.RSVP.Promise(function(a){a(h)}),h.notifyLoaded()):a=e(this,"adapter").findMany(this,h,g)}a.then(function(){for(var a=0,b=d.length;b>a;a++)d[a].loadForFindMany(f)})},findQuery:function(a){var b=Ember.RecordArray.create();return this.adapter.findQuery(this,b,a),b},cachedRecordForId:function(a){this.recordCache||(this.recordCache={});var b;if(this.recordCache[a])b=this.recordCache[a];else{var c=e(this,"primaryKey"),d={isLoaded:!1};d[c]=a,b=this.create(d);var f=this.sideloadedData&&this.sideloadedData[a];f&&b.load(a,f),this.recordCache[a]=b}return b},addToRecordArrays:function(a){this._findAllRecordArray&&this._findAllRecordArray.pushObject(a),this.recordArrays&&this.recordArrays.forEach(function(b){b instanceof Ember.FilteredRecordArray?(b.registerObserversOnRecord(a),b.updateFilter()):b.pushObject(a)})},removeFromRecordArrays:function(a){this._findAllRecordArray&&this._findAllRecordArray.removeObject(a),this.recordArrays&&this.recordArrays.forEach(function(b){b.removeObject(a)})},findFromCacheOrLoad:function(a){var b;return b=a[e(this,"primaryKey")]?this.cachedRecordForId(a[e(this,"primaryKey")]):this.create({isLoaded:!1}),b.load(a[e(this,"primaryKey")],a),b},registerRecordArray:function(a){this.recordArrays||(this.recordArrays=[]),this.recordArrays.push(a)},unregisterRecordArray:function(a){this.recordArrays&&Ember.A(this.recordArrays).removeObject(a)},forEachCachedRecord:function(a){if(!this.recordCache)return Ember.A([]);var b=Object.keys(this.recordCache);b.map(function(a){return this.recordCache[a]},this).forEach(a)},load:function(a){this.sideloadedData||(this.sideloadedData={});for(var b=0,c=a.length;c>b;b++){var d=a[b];this.sideloadedData[d[e(this,"primaryKey")]]=d}},_referenceForId:function(a){this._idToReference||(this._idToReference={});var b=this._idToReference[a];return b||(b=this._createReference(a)),b},_createReference:function(a){this._idToReference||(this._idToReference={});var b={id:a,clientId:this._clientIdCounter++};return a&&(this._idToReference[a]=b),b}})}(),function(){Ember.get,Ember.hasMany=function(a,b){b=b||{};var c={type:a,isRelationship:!0,options:b,kind:"hasMany"},d=b.key;return Ember.computed(function(){return"string"==typeof a&&(a=Ember.get(Ember.lookup,a)),this.getHasMany(d,a,c)}).property().meta(c)},Ember.Model.reopen({getHasMany:function(a,b,c){var d=c.options.embedded,e=d?Ember.EmbeddedHasManyArray:Ember.HasManyArray,f=e.create({parent:this,modelClass:b,content:this._getHasManyContent(a,b,d),embedded:d,key:a});return this._registerHasManyArray(f),f}})}(),function(){function a(){return"string"==typeof this.type&&(this.type=Ember.get(Ember.lookup,this.type)),this.type}var b=Ember.get;Ember.belongsTo=function(b,c){c=c||{};var d={type:b,isRelationship:!0,options:c,kind:"belongsTo",getType:a},e=c.key;return Ember.computed(function(a,c){return b=d.getType(),2===arguments.length?void 0===c?null:c:this.getBelongsTo(e,b,d)}).property("_data").meta(d)},Ember.Model.reopen({getBelongsTo:function(a,c,d){var e,f=b(this,"_data."+a);if(Ember.isNone(f))return null;if(d.options.embedded){var g=b(c,"primaryKey");e=c.create({isLoaded:!1}),e.load(f[g],f)}else e=c.findById(f);return e}})}(),function(){function a(b){if(Ember.isArray(b)){for(var c=b.slice(),d=0,e=c.length;e>d;d++)c[d]=a(c[d]);return Ember.A(c)}if(b&&b.constructor===Date)return new Date(b.toISOString());if(b&&"object"==typeof b){var f,g=Ember.create(b);for(f in b)b.hasOwnProperty(f)&&"object"==typeof b[f]&&(g[f]=a(b[f]));return g}return b}function b(b,c){return c&&c.deserialize?c.deserialize(b):c&&Ember.Model.dataTypes[c]?Ember.Model.dataTypes[c].deserialize(b):a(b)}var c=Ember.get,d=Ember.set,e=Ember.meta;Ember.Model.dataTypes={},Ember.Model.dataTypes[Date]={deserialize:function(a){return a?new Date(a):null},serialize:function(a){return a?a.toISOString():null},isEqual:function(a,b){return a instanceof Date&&(a=this.serialize(a)),b instanceof Date&&(b=this.serialize(b)),a===b}},Ember.Model.dataTypes[Number]={deserialize:function(a){return a||0===a?Number(a):null},serialize:function(a){return a||0===a?Number(a):null}},Ember.attr=function(f,g){return Ember.computed(function(g,h){var i=c(this,"_data"),j=this.dataKey(g),k=i&&c(i,j),l=e(this).proto===this;return 2===arguments.length?(l&&!i&&(i={},d(this,"_data",i),i[j]=h),a(h)):this.getAttr(g,b(k,f))}).property("_data").meta({isAttribute:!0,type:f,options:g})}}(),function(){var a=Ember.get;Ember.RESTAdapter=Ember.Adapter.extend({find:function(a,b){var c=this.buildURL(a.constructor,b),d=this;return this.ajax(c).then(function(c){d.didFind(a,b,c)})},didFind:function(b,c,d){var e=a(b.constructor,"rootKey"),f=e?d[e]:d;b.load(c,f)},findAll:function(a,b){var c=this.buildURL(a),d=this;return this.ajax(c).then(function(c){d.didFindAll(a,b,c)})},didFindAll:function(b,c,d){var e=a(b,"collectionKey"),f=e?d[e]:d;c.load(b,f)},findQuery:function(a,b,c){var d=this.buildURL(a),e=this;return this.ajax(d,c).then(function(d){e.didFindQuery(a,b,c,d)})},didFindQuery:function(b,c,d,e){var f=a(b,"collectionKey"),g=f?e[f]:e;c.load(b,g)},createRecord:function(a){var b=this.buildURL(a.constructor),c=this;return this.ajax(b,a.toJSON(),"POST").then(function(b){c.didCreateRecord(a,b)})},didCreateRecord:function(b,c){var d=a(b.constructor,"rootKey"),e=a(b.constructor,"primaryKey"),f=d?c[d]:c;b.load(f[e],f),b.didCreateRecord()},saveRecord:function(b){var c=a(b.constructor,"primaryKey"),d=this.buildURL(b.constructor,a(b,c)),e=this;return this.ajax(d,b.toJSON(),"PUT").then(function(a){e.didSaveRecord(b,a)})},didSaveRecord:function(a){a.didSaveRecord()},deleteRecord:function(b){var c=a(b.constructor,"primaryKey"),d=this.buildURL(b.constructor,a(b,c)),e=this;return this.ajax(d,b.toJSON(),"DELETE").then(function(a){e.didDeleteRecord(b,a)})},didDeleteRecord:function(a){a.didDeleteRecord()},ajax:function(a,b,c){return this._ajax(a,b,c||"GET")},buildURL:function(b,c){var d=a(b,"url");if(!d)throw new Error("Ember.RESTAdapter requires a `url` property to be specified");return c?d+"/"+c+".json":d+".json"},ajaxSettings:function(a,b){return{url:a,type:b,dataType:"json"}},_ajax:function(a,b,c){var d=this.ajaxSettings(a,c);return new Ember.RSVP.Promise(function(a,e){b&&("GET"===c?d.data=b:(d.contentType="application/json; charset=utf-8",d.data=JSON.stringify(b))),d.success=function(b){Ember.run(null,a,b)},d.error=function(a){Ember.run(null,e,a)},Ember.$.ajax(d)})}})}(),function(){var a=Ember.get;Ember.LoadPromise=Ember.Object.extend(Ember.DeferredMixin,{init:function(){this._super.apply(this,arguments);var b=a(this,"target");a(b,"isLoaded")&&!a(b,"isNew")?this.resolve(b):b.one("didLoad",this,function(){this.resolve(b)})}}),Ember.loadPromise=function(a){return Ember.isNone(a)?null:a.then?a:Ember.LoadPromise.create({target:a})}}();